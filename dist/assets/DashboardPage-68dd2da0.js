import{c as I,j as t,B as _,b as L,m as T,L as Ee,P as Ae,r as n,I as S,z as P,U as Te,s as D,R as Re,e as te,y as U,u as Q,d as ne,F as oe,a as Le,f as Ie}from"./index-90132984.js";import{T as Oe,a as Fe,b as ze,c as qe}from"./tabs-1cd19a03.js";import{P as ie}from"./plus-circle-68c8968c.js";import{L as Ue,T as le}from"./trash-2-c21e1822.js";import{C as Y,b as H,c as B,d as V,a as X}from"./card-20bc08aa.js";import{L as N}from"./label-10800e5f.js";import{A as Ye,a as He,b as Be}from"./avatar-ea0057bf.js";import{r as M,t as k,e as Ve,g as re,a as Xe}from"./index-928e16c7.js";import{e as We,d as Ge}from"./index-53deacd1.js";import{S as ce}from"./star-af4081c4.js";import{A as Ze,a as Ke,b as Qe,c as Je,d as et,e as tt,f as rt,g as at}from"./alert-dialog-e7e47e0b.js";import{_ as R}from"./extends-4c19d496.js";import{s as Z}from"./customSupabaseClient-6a2b5399.js";import{S as st}from"./shield-e8660eba.js";import{K as nt}from"./key-round-43716dd5.js";import{C as ot}from"./credit-card-e15c187e.js";import{L as it}from"./log-in-88f4232d.js";import{M as lt}from"./MyShipmentsTabs-9e341ffe.js";import{A as ct}from"./AuthErrorDisplay-1bdc45af.js";import{U as dt}from"./user-404ce197.js";import"./index-8d46d079.js";import"./package-63d15fb6.js";import"./arrow-right-cf1dab7a.js";import"./calendar-a9d8c619.js";import"./index-ca7fca51.js";const ut=I("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),mt=I("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),de=I("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),ft=I("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),ht=I("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function q(e,r){M(2,arguments);var a=k(e),o=k(r),s=a.getTime()-o.getTime();return s<0?-1:s>0?1:s}function xt(e,r){return M(2,arguments),k(e).getTime()-k(r).getTime()}var ae={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(r){return r<0?Math.ceil(r):Math.floor(r)}},gt="trunc";function pt(e){return e?ae[e]:ae[gt]}function bt(e){M(1,arguments);var r=k(e);return r.setHours(23,59,59,999),r}function yt(e){M(1,arguments);var r=k(e);return bt(r).getTime()===We(r).getTime()}function vt(e,r){M(2,arguments);var a=k(e),o=k(r),s=q(a,o),l=Math.abs(Ge(a,o)),i;if(l<1)i=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-s*l);var c=q(a,o)===-s;yt(k(e))&&l===1&&q(e,o)===1&&(c=!1),i=s*(l-Number(c))}return i===0?0:i}function kt(e,r,a){M(2,arguments);var o=xt(e,r)/1e3;return pt(a==null?void 0:a.roundingMethod)(o)}function ue(e,r){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}function wt(e){return ue({},e)}var se=1440,jt=2520,W=43200,Nt=86400;function _t(e,r,a){var o,s;M(2,arguments);var l=Xe(),i=(o=(s=a==null?void 0:a.locale)!==null&&s!==void 0?s:l.locale)!==null&&o!==void 0?o:Ve;if(!i.formatDistance)throw new RangeError("locale must contain formatDistance property");var c=q(e,r);if(isNaN(c))throw new RangeError("Invalid time value");var d=ue(wt(a),{addSuffix:!!(a!=null&&a.addSuffix),comparison:c}),u,g;c>0?(u=k(r),g=k(e)):(u=k(e),g=k(r));var f=kt(g,u),m=(re(g)-re(u))/1e3,h=Math.round((f-m)/60),x;if(h<2)return a!=null&&a.includeSeconds?f<5?i.formatDistance("lessThanXSeconds",5,d):f<10?i.formatDistance("lessThanXSeconds",10,d):f<20?i.formatDistance("lessThanXSeconds",20,d):f<40?i.formatDistance("halfAMinute",0,d):f<60?i.formatDistance("lessThanXMinutes",1,d):i.formatDistance("xMinutes",1,d):h===0?i.formatDistance("lessThanXMinutes",1,d):i.formatDistance("xMinutes",h,d);if(h<45)return i.formatDistance("xMinutes",h,d);if(h<90)return i.formatDistance("aboutXHours",1,d);if(h<se){var y=Math.round(h/60);return i.formatDistance("aboutXHours",y,d)}else{if(h<jt)return i.formatDistance("xDays",1,d);if(h<W){var b=Math.round(h/se);return i.formatDistance("xDays",b,d)}else if(h<Nt)return x=Math.round(h/W),i.formatDistance("aboutXMonths",x,d)}if(x=vt(g,u),x<12){var C=Math.round(h/W);return i.formatDistance("xMonths",C,d)}else{var j=x%12,w=Math.floor(x/12);return j<3?i.formatDistance("aboutXYears",w,d):j<9?i.formatDistance("overXYears",w,d):i.formatDistance("almostXYears",w+1,d)}}function St(e,r){return M(1,arguments),_t(e,Date.now(),r)}const Ct=({profile:e,onSignOut:r})=>{const a=s=>s?s.split(" ")[0]:null,o=(e==null?void 0:e.first_name)||a(e==null?void 0:e.full_name)||(e==null?void 0:e.email)||"User";return t.jsx("header",{className:"mb-10",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-slate-800 dark:text-white",children:["Welcome back, ",t.jsx("span",{className:"text-primary dark:text-purple-400",children:o}),"!"]}),t.jsxs("p",{className:"text-muted-foreground dark:text-slate-300 mt-1",children:["Here's your ",t.jsx("span",{className:"font-vernaccia-bold",children:"Yankit"})," activity overview."]})]}),t.jsxs(_,{onClick:r,variant:"outline",className:"border-slate-300 text-slate-700 hover:bg-slate-100 dark:text-slate-200 dark:border-slate-600 dark:hover:bg-slate-700 dark:hover:text-white",children:[t.jsx(de,{size:16,className:"mr-2"})," Sign Out"]})]})})},$t=[{icon:ie,title:"Create Listing",description:"Offer your baggage space for others.",link:"/list-your-bag",color:"from-purple-500 to-indigo-500",action:()=>{}},{icon:Ae,title:"Find Shipments",description:"Search for bags to carry on your flight.",link:"/yank-a-bag-now",color:"from-blue-500 to-sky-500",action:()=>{}},{icon:mt,title:"My Shipments",description:"View and manage your sent/carried bags.",link:"/my-shipments",color:"from-green-500 to-teal-500",action:()=>{}},{icon:Ue,title:"My Listings",description:"Manage your available baggage space listings.",link:"/my-listings",color:"from-yellow-500 to-orange-500",action:()=>{}}],Dt=()=>(L(),t.jsxs("section",{className:"mb-10",children:[t.jsx(T.h2,{className:"text-3xl font-bold mb-6 text-center text-gray-800 dark:text-white",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:"Quick Actions"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:$t.map((e,r)=>t.jsx(T.div,{className:`bg-gradient-to-br ${e.color} rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*r,duration:.5},children:t.jsxs("div",{className:"p-6 text-white flex flex-col items-start h-full",children:[t.jsx("div",{className:"mb-3 text-white",children:t.jsx(e.icon,{size:36,strokeWidth:1.5})}),t.jsx("h3",{className:"text-xl font-semibold mb-2",children:e.title}),t.jsx("p",{className:"text-sm opacity-90 mb-4 flex-grow",children:e.description}),t.jsx(_,{asChild:!0,className:"bg-white text-gray-800 hover:bg-gray-100 dark:bg-slate-700 dark:text-white dark:hover:bg-slate-600 w-full",children:t.jsx(Ee,{to:e.link,children:"Go Now"})})]})},r))})]})),Pt=({profile:e,session:r,onProfileUpdate:a,stats:o})=>{const{toast:s}=L(),[l,i]=n.useState({full_name:"",email:"",first_name:"",surname:"",address_line1:"",address_line2:"",city:"",state_province_region:"",postal_code:"",country:""}),[c,d]=n.useState(!1);n.useEffect(()=>{var f;e&&i({full_name:e.full_name||"",email:e.email||((f=r==null?void 0:r.user)==null?void 0:f.email)||"",first_name:e.first_name||"",surname:e.surname||"",address_line1:e.address_line1||"",address_line2:e.address_line2||"",city:e.city||"",state_province_region:e.state_province_region||"",postal_code:e.postal_code||"",country:e.country||""})},[e,r]);const u=f=>{const{id:m,value:h}=f.target;i(x=>({...x,[m]:h}))},g=async f=>{f.preventDefault(),d(!0);try{await a(l),s({title:"Profile Updated! ðŸŽ‰",description:"Your profile information has been successfully saved.",variant:"success"})}catch(m){console.error("Error updating profile:",m),s({title:"Uh oh! Something went wrong.",description:"There was an error saving your profile. Please try again.",variant:"destructive"})}finally{d(!1)}};return t.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:t.jsxs(Y,{className:"bg-background/80 dark:bg-slate-900/80 shadow-lg border-none",children:[t.jsxs(H,{children:[t.jsx(B,{className:"text-2xl font-bold text-primary dark:text-white",children:"Personal Information"}),t.jsx(V,{className:"text-muted-foreground dark:text-slate-400",children:"Update your personal details and email address."})]}),t.jsx(X,{children:t.jsxs("form",{onSubmit:g,className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(N,{htmlFor:"first_name",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"First Name"}),t.jsx(S,{id:"first_name",value:l.first_name,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"surname",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"Surname"}),t.jsx(S,{id:"surname",value:l.surname,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"email",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"Email Address"}),t.jsx(S,{id:"email",type:"email",value:l.email,onChange:u,disabled:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white cursor-not-allowed"}),t.jsx("p",{className:"mt-2 text-sm text-muted-foreground dark:text-slate-400",children:"Email address cannot be changed here. Please contact support to update your email."})]}),t.jsx("h3",{className:"text-xl font-semibold text-primary dark:text-white mt-8 mb-4",children:"Address Information"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(N,{htmlFor:"address_line1",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"Address Line 1"}),t.jsx(S,{id:"address_line1",value:l.address_line1,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"address_line2",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"Address Line 2 (Optional)"}),t.jsx(S,{id:"address_line2",value:l.address_line2,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"city",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"City"}),t.jsx(S,{id:"city",value:l.city,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"state_province_region",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"State/Province/Region"}),t.jsx(S,{id:"state_province_region",value:l.state_province_region,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"postal_code",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"Postal Code"}),t.jsx(S,{id:"postal_code",value:l.postal_code,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx(N,{htmlFor:"country",className:"text-sm font-medium text-gray-700 dark:text-slate-300",children:"Country"}),t.jsx(S,{id:"country",value:l.country,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]})]}),t.jsx(_,{type:"submit",className:"w-full md:w-auto bg-gradient-to-r from-sky-500 to-cyan-500 hover:from-sky-600 hover:to-cyan-600 text-white font-bold py-2 px-6 rounded-md shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105",disabled:c,children:c?t.jsx(P,{}):"Save Changes"})]})})]})})},Mt=({userId:e})=>{const[r,a]=n.useState([]),[o,s]=n.useState(!0),[l,i]=n.useState(null);return n.useEffect(()=>{if(!e){s(!1);return}(async()=>{s(!0),i(null);try{const{data:d,error:u}=await D.from("reviews").select(`
                id,
                rating,
                comment,
                created_at,
                review_type,
                shipment_id,
                reviewer:reviewer_user_id ( id, full_name, avatar_url )
              `).eq("reviewed_user_id",e).order("created_at",{ascending:!1});if(u)throw u;a(d||[])}catch(d){console.error("Error fetching reviews:",d),i("Failed to load reviews. Please try again later.")}finally{s(!1)}})()},[e]),o?t.jsx("div",{className:"flex justify-center items-center py-10",children:t.jsx(P,{})}):l?t.jsx("p",{className:"text-center text-red-500 dark:text-red-400 py-10",children:l}):r.length===0?t.jsx("p",{className:"text-center text-muted-foreground dark:text-slate-400 py-10",children:"No reviews yet."}):t.jsx("div",{className:"space-y-6",children:r.map(c=>{var d,u,g,f;return t.jsxs(Y,{className:"overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700",children:[t.jsx(H,{className:"bg-slate-50 dark:bg-slate-700/50 p-4 border-b dark:border-slate-600",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs(Ye,{className:"h-10 w-10 border-2 border-primary dark:border-purple-500",children:[t.jsx(He,{src:(d=c.reviewer)==null?void 0:d.avatar_url,alt:((u=c.reviewer)==null?void 0:u.full_name)||"Reviewer"}),t.jsx(Be,{className:"bg-slate-200 dark:bg-slate-600 text-primary dark:text-purple-300",children:(g=c.reviewer)!=null&&g.full_name?c.reviewer.full_name.charAt(0).toUpperCase():t.jsx(Te,{size:20})})]}),t.jsxs("div",{children:[t.jsx(B,{className:"text-base font-semibold text-slate-800 dark:text-slate-100",children:((f=c.reviewer)==null?void 0:f.full_name)||"Anonymous Reviewer"}),t.jsxs(V,{className:"text-xs text-slate-500 dark:text-slate-400",children:["Reviewed ",t.jsx("span",{className:"font-medium",children:St(new Date(c.created_at),{addSuffix:!0})})]})]})]}),t.jsx("div",{className:"flex items-center space-x-1",children:[...Array(5)].map((m,h)=>t.jsx(ce,{size:16,className:h<c.rating?"text-yellow-400 fill-yellow-400":"text-slate-300 dark:text-slate-500"},h))})]})}),t.jsxs(X,{className:"p-4",children:[c.comment?t.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 leading-relaxed italic",children:['"',c.comment,'"']}):t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"No comment provided."}),t.jsxs("div",{className:"mt-3 text-xs text-slate-400 dark:text-slate-500",children:["Shipment ID: ",c.shipment_id.slice(0,8)]})]})]},c.id)})})},Et=({userId:e})=>t.jsxs(Y,{className:"shadow-lg glassmorphism dark:bg-slate-800/60 dark:border-slate-700/50",children:[t.jsxs(H,{children:[t.jsx(B,{className:"text-xl font-semibold text-slate-700 dark:text-slate-200",children:"Reviews About You"}),t.jsx(V,{className:"text-sm text-muted-foreground dark:text-slate-400",children:"See what other users are saying about their transactions with you."})]}),t.jsx(X,{children:t.jsx(Mt,{userId:e})})]});function At(e,r,{checkForDefaultPrevented:a=!0}={}){return function(s){if(e==null||e(s),a===!1||!s.defaultPrevented)return r==null?void 0:r(s)}}function Tt(e,r){typeof e=="function"?e(r):e!=null&&(e.current=r)}function me(...e){return r=>e.forEach(a=>Tt(a,r))}function Rt(...e){return n.useCallback(me(...e),e)}function Lt(e,r=[]){let a=[];function o(l,i){const c=n.createContext(i),d=a.length;a=[...a,i];function u(f){const{scope:m,children:h,...x}=f,y=(m==null?void 0:m[e][d])||c,b=n.useMemo(()=>x,Object.values(x));return n.createElement(y.Provider,{value:b},h)}function g(f,m){const h=(m==null?void 0:m[e][d])||c,x=n.useContext(h);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${l}\``)}return u.displayName=l+"Provider",[u,g]}const s=()=>{const l=a.map(i=>n.createContext(i));return function(c){const d=(c==null?void 0:c[e])||l;return n.useMemo(()=>({[`__scope${e}`]:{...c,[e]:d}}),[c,d])}};return s.scopeName=e,[o,It(s,...r)]}function It(...e){const r=e[0];if(e.length===1)return r;const a=()=>{const o=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(l){const i=o.reduce((c,{useScope:d,scopeName:u})=>{const f=d(l)[`__scope${u}`];return{...c,...f}},{});return n.useMemo(()=>({[`__scope${r.scopeName}`]:i}),[i])}};return a.scopeName=r.scopeName,a}function fe(e){const r=n.useRef(e);return n.useEffect(()=>{r.current=e}),n.useMemo(()=>(...a)=>{var o;return(o=r.current)===null||o===void 0?void 0:o.call(r,...a)},[])}function Ot({prop:e,defaultProp:r,onChange:a=()=>{}}){const[o,s]=Ft({defaultProp:r,onChange:a}),l=e!==void 0,i=l?e:o,c=fe(a),d=n.useCallback(u=>{if(l){const f=typeof u=="function"?u(e):u;f!==e&&c(f)}else s(u)},[l,e,s,c]);return[i,d]}function Ft({defaultProp:e,onChange:r}){const a=n.useState(e),[o]=a,s=n.useRef(o),l=fe(r);return n.useEffect(()=>{s.current!==o&&(l(o),s.current=o)},[o,s,l]),a}function zt(e){const r=n.useRef({value:e,previous:e});return n.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}const qt=globalThis!=null&&globalThis.document?n.useLayoutEffect:()=>{};function Ut(e){const[r,a]=n.useState(void 0);return qt(()=>{if(e){a({width:e.offsetWidth,height:e.offsetHeight});const o=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const l=s[0];let i,c;if("borderBoxSize"in l){const d=l.borderBoxSize,u=Array.isArray(d)?d[0]:d;i=u.inlineSize,c=u.blockSize}else i=e.offsetWidth,c=e.offsetHeight;a({width:i,height:c})});return o.observe(e,{box:"border-box"}),()=>o.unobserve(e)}else a(void 0)},[e]),r}const he=n.forwardRef((e,r)=>{const{children:a,...o}=e,s=n.Children.toArray(a),l=s.find(Ht);if(l){const i=l.props.children,c=s.map(d=>d===l?n.Children.count(i)>1?n.Children.only(null):n.isValidElement(i)?i.props.children:null:d);return n.createElement(K,R({},o,{ref:r}),n.isValidElement(i)?n.cloneElement(i,void 0,c):null)}return n.createElement(K,R({},o,{ref:r}),a)});he.displayName="Slot";const K=n.forwardRef((e,r)=>{const{children:a,...o}=e;return n.isValidElement(a)?n.cloneElement(a,{...Bt(o,a.props),ref:r?me(r,a.ref):a.ref}):n.Children.count(a)>1?n.Children.only(null):null});K.displayName="SlotClone";const Yt=({children:e})=>n.createElement(n.Fragment,null,e);function Ht(e){return n.isValidElement(e)&&e.type===Yt}function Bt(e,r){const a={...r};for(const o in r){const s=e[o],l=r[o];/^on[A-Z]/.test(o)?s&&l?a[o]=(...c)=>{l(...c),s(...c)}:s&&(a[o]=s):o==="style"?a[o]={...s,...l}:o==="className"&&(a[o]=[s,l].filter(Boolean).join(" "))}return{...e,...a}}const Vt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],xe=Vt.reduce((e,r)=>{const a=n.forwardRef((o,s)=>{const{asChild:l,...i}=o,c=l?he:r;return n.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),n.createElement(c,R({},i,{ref:s}))});return a.displayName=`Primitive.${r}`,{...e,[r]:a}},{}),ge="Switch",[Xt,Tr]=Lt(ge),[Wt,Gt]=Xt(ge),Zt=n.forwardRef((e,r)=>{const{__scopeSwitch:a,name:o,checked:s,defaultChecked:l,required:i,disabled:c,value:d="on",onCheckedChange:u,...g}=e,[f,m]=n.useState(null),h=Rt(r,j=>m(j)),x=n.useRef(!1),y=f?!!f.closest("form"):!0,[b=!1,C]=Ot({prop:s,defaultProp:l,onChange:u});return n.createElement(Wt,{scope:a,checked:b,disabled:c},n.createElement(xe.button,R({type:"button",role:"switch","aria-checked":b,"aria-required":i,"data-state":pe(b),"data-disabled":c?"":void 0,disabled:c,value:d},g,{ref:h,onClick:At(e.onClick,j=>{C(w=>!w),y&&(x.current=j.isPropagationStopped(),x.current||j.stopPropagation())})})),y&&n.createElement(Jt,{control:f,bubbles:!x.current,name:o,value:d,checked:b,required:i,disabled:c,style:{transform:"translateX(-100%)"}}))}),Kt="SwitchThumb",Qt=n.forwardRef((e,r)=>{const{__scopeSwitch:a,...o}=e,s=Gt(Kt,a);return n.createElement(xe.span,R({"data-state":pe(s.checked),"data-disabled":s.disabled?"":void 0},o,{ref:r}))}),Jt=e=>{const{control:r,checked:a,bubbles:o=!0,...s}=e,l=n.useRef(null),i=zt(a),c=Ut(r);return n.useEffect(()=>{const d=l.current,u=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(u,"checked").set;if(i!==a&&f){const m=new Event("click",{bubbles:o});f.call(d,a),d.dispatchEvent(m)}},[i,a,o]),n.createElement("input",R({type:"checkbox","aria-hidden":!0,defaultChecked:a},s,{tabIndex:-1,ref:l,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function pe(e){return e?"checked":"unchecked"}const be=Zt,er=Qt,ye=Re.forwardRef(({className:e,...r},a)=>t.jsx(be,{className:te("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...r,ref:a,children:t.jsx(er,{className:te("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ye.displayName=be.displayName;const tr=()=>{var f;const{session:e}=U(),{toast:r}=L(),[a,o]=n.useState(null),[s,l]=n.useState(!0),[i,c]=n.useState(null),d=n.useCallback(async()=>{var x;if(!((x=e==null?void 0:e.user)!=null&&x.id))return;l(!0),c(null);const{data:m,error:h}=await Z.from("user_notification_preferences").select("*").eq("user_id",e.user.id).single();h&&h.code!=="PGRST116"?(console.error("Error fetching notification preferences:",h),c("Could not load your notification settings. Please try again."),r({title:"Error",description:"Failed to fetch notification settings.",variant:"destructive"})):o(m),l(!1)},[(f=e==null?void 0:e.user)==null?void 0:f.id,r]);n.useEffect(()=>{d()},[d]);const u=async(m,h)=>{if(!a)return;const x={...a},y={...a,[m]:h,updated_at:new Date().toISOString()};o(y);const{error:b}=await Z.from("user_notification_preferences").update({[m]:h,updated_at:new Date().toISOString()}).eq("user_id",e.user.id);b?(console.error("Error updating notification preferences:",b),r({title:"Error",description:"Failed to save your changes.",variant:"destructive"}),o(x)):r({title:"Success",description:"Notification settings updated.",className:"bg-green-500 text-white"})};if(s)return t.jsx("div",{className:"flex justify-center items-center h-24",children:t.jsx(P,{})});if(i)return t.jsx("p",{className:"text-destructive text-center",children:i});if(!a)return t.jsx("p",{className:"text-muted-foreground text-center",children:"Notification settings are not available at the moment."});const g=[{id:"new_message_email",label:"New Messages",description:"Receive an email when you get a new message.",key:"new_message_email"},{id:"shipment_update_email",label:"Shipment Updates",description:"Get notified about the status of your shipments.",key:"shipment_update_email"},{id:"promotional_email",label:"Promotions & News",description:"Receive occasional updates and special offers from Yankit.",key:"promotional_email"}];return t.jsx("div",{className:"space-y-6",children:g.map(m=>t.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50 dark:bg-slate-700/30",children:[t.jsxs("div",{children:[t.jsx(N,{htmlFor:m.id,className:"font-semibold text-foreground dark:text-slate-200",children:m.label}),t.jsx("p",{className:"text-sm text-muted-foreground dark:text-slate-400",children:m.description})]}),t.jsx(ye,{id:m.id,checked:a[m.key],onCheckedChange:h=>u(m.key,h)})]},m.id))})},rr=()=>{var f;const{session:e}=U(),{toast:r}=L(),[a,o]=n.useState([]),[s,l]=n.useState(!0),[i,c]=n.useState(null),d=n.useCallback(async()=>{var x;if(!((x=e==null?void 0:e.user)!=null&&x.id))return;l(!0),c(null);const{data:m,error:h}=await Z.from("user_payment_methods").select("*").eq("user_id",e.user.id).order("created_at",{ascending:!1});h?(console.error("Error fetching payment methods:",h),c("Could not load your payment methods. Please try again."),r({title:"Error",description:"Failed to fetch payment methods.",variant:"destructive"})):o(m),l(!1)},[(f=e==null?void 0:e.user)==null?void 0:f.id,r]);n.useEffect(()=>{d()},[d]);const u=()=>{r({title:"ðŸš§ Feature In Development",description:"Adding new payment methods via Stripe is coming soon! You can request this in your next prompt.",className:"bg-sky-500 dark:bg-sky-600 text-white"})},g=m=>{r({title:"ðŸš§ Feature In Development",description:"Removing payment methods is coming soon!",className:"bg-sky-500 dark:bg-sky-600 text-white"})};return s?t.jsx("div",{className:"flex justify-center items-center h-24",children:t.jsx(P,{})}):i?t.jsx("p",{className:"text-destructive text-center",children:i}):t.jsxs("div",{className:"space-y-4",children:[a.length>0?t.jsx("ul",{className:"space-y-3",children:a.map(m=>t.jsxs("li",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50 dark:bg-slate-700/30",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-foreground dark:text-slate-200",children:[t.jsx("span",{className:"capitalize",children:m.card_brand})," ending in ",m.last4]}),m.is_default&&t.jsx("span",{className:"text-xs text-primary dark:text-purple-400 font-semibold",children:"Default"})]}),t.jsx(_,{variant:"ghost",size:"icon",onClick:()=>g(m.id),children:t.jsx(le,{className:"h-4 w-4 text-destructive"})})]},m.id))}):t.jsx("p",{className:"text-center text-muted-foreground dark:text-slate-400 py-4",children:"You have no saved payment methods."}),t.jsxs(_,{onClick:u,variant:"outline",className:"w-full dark:text-slate-300 dark:border-slate-600 dark:hover:bg-slate-700",children:[t.jsx(ie,{className:"mr-2 h-4 w-4"})," Add New Payment Method"]})]})},A=({title:e,description:r,icon:a,children:o})=>t.jsxs(Y,{className:"bg-background/70 dark:bg-slate-800/50 shadow-lg border-border dark:border-slate-700/50",children:[t.jsx(H,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(a,{className:"w-6 h-6 text-primary dark:text-purple-400"}),t.jsxs("div",{children:[t.jsx(B,{className:"text-xl text-foreground dark:text-slate-100",children:e}),t.jsx(V,{className:"text-muted-foreground dark:text-slate-400",children:r})]})]})}),t.jsx(X,{children:o})]}),ar=({onSignOut:e})=>{var u;const{toast:r}=L(),{session:a}=U(),o=Q(),[s,l]=n.useState(!1),[i,c]=n.useState(!1),d=async()=>{c(!0),r({title:"Deleting Account...",description:"Please wait while we process your request."});const{error:g}=await D.rpc("delete_user_account");c(!1),l(!1),g?(console.error("Error deleting account:",g),r({title:"Error Deleting Account",description:g.message||"Could not delete your account. Please try again or contact support.",variant:"destructive"})):(r({title:"Account Deleted",description:"Your account has been successfully deleted. We're sorry to see you go."}),await e(),o("/"))};return t.jsxs("div",{className:"space-y-8 text-foreground dark:text-slate-200",children:[t.jsx(A,{title:"Account Settings",description:"Manage your account details and preferences.",icon:st,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(N,{htmlFor:"email",className:"text-sm font-medium text-foreground dark:text-slate-300",children:"Email Address"}),t.jsx(S,{id:"email",type:"email",defaultValue:((u=a==null?void 0:a.user)==null?void 0:u.email)||"",disabled:!0,className:"mt-1 bg-muted dark:bg-slate-700/60 dark:text-slate-400"})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:t.jsxs(_,{variant:"outline",className:"dark:text-slate-300 dark:border-slate-600 dark:hover:bg-slate-700",onClick:()=>o("/change-password"),children:[t.jsx(nt,{className:"mr-2 h-4 w-4"})," Change Password"]})})]})}),t.jsx(A,{title:"Notification Preferences",description:"Control how you receive notifications from Yankit.",icon:ut,children:t.jsx(tr,{})}),t.jsx(A,{title:"Appearance",description:"Customize the look and feel of your dashboard.",icon:ft,children:t.jsx("p",{className:"text-sm text-muted-foreground dark:text-slate-400",children:"Theme settings are managed globally via the Light/Dark mode toggle in the header."})}),t.jsx(A,{title:"Payment Methods",description:"Manage your saved payment methods.",icon:ot,children:t.jsx(rr,{})}),t.jsx(A,{title:"Danger Zone",description:"Irreversible actions for your account.",icon:le,children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 bg-destructive/10 dark:bg-red-900/20 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-destructive dark:text-red-400",children:"Delete Account"}),t.jsx("p",{className:"text-sm text-muted-foreground dark:text-red-400/80",children:"Once you delete your account, there is no going back. Please be certain."})]}),t.jsx(_,{onClick:()=>l(!0),variant:"destructive",className:"mt-3 sm:mt-0",children:"Delete My Account"})]})}),t.jsx(Ze,{open:s,onOpenChange:l,children:t.jsxs(Ke,{children:[t.jsxs(Qe,{children:[t.jsx(Je,{children:"Are you absolutely sure?"}),t.jsx(et,{children:"This action cannot be undone. This will permanently delete your account and all associated data, including your listings, shipments, and messages."})]}),t.jsxs(tt,{children:[t.jsx(rt,{disabled:i,children:"Cancel"}),t.jsx(at,{onClick:d,disabled:i,className:"bg-destructive hover:bg-destructive/90",children:i?t.jsxs(t.Fragment,{children:[t.jsx(P,{className:"mr-2"})," Deleting..."]}):"Yes, delete my account"})]})]})}),t.jsxs(A,{title:"Sign Out",description:"Securely sign out of your Yankit account.",icon:de,children:[t.jsx(_,{onClick:e,variant:"outline",className:"w-full sm:w-auto dark:text-slate-300 dark:border-slate-600 dark:hover:bg-slate-700",children:"Sign Out"}),t.jsx("p",{className:"mt-2 text-xs text-muted-foreground dark:text-slate-500",children:"You will be logged out from this device."})]})]})},sr={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},nr=({onSignIn:e})=>t.jsxs(T.div,{initial:"initial",animate:"in",exit:"out",variants:sr,transition:{duration:.5},className:"container mx-auto py-12 px-4 md:px-6 min-h-[calc(100vh-180px)] flex flex-col items-center justify-center text-center",children:[t.jsx(T.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20,delay:.2},className:"p-4 bg-gradient-to-r from-primary to-secondary rounded-full shadow-xl mb-6",children:t.jsx(ne,{className:"w-12 h-12 text-white"})}),t.jsx("h2",{className:"text-3xl font-bold text-foreground dark:text-white mb-3",children:"Access Your Dashboard"}),t.jsx("p",{className:"text-lg text-muted-foreground dark:text-slate-300 max-w-md mb-8",children:"Please sign in to manage your flights, baggage offers, and shipments."}),t.jsxs(_,{onClick:e,className:"bg-gradient-to-r from-primary to-purple-600 hover:opacity-90 text-white dark:from-secondary dark:to-orange-400 py-3 px-6 text-lg",children:[t.jsx(it,{className:"w-5 h-5 mr-2"}),"Sign In"]})]}),G=async(e,r,a)=>{const{count:o,error:s}=await D.from(e).select("id",{count:"exact",head:!0}).eq(r,a);if(s)throw console.error(`Supabase query error for ${e} count:`,s.message),s;return o||0},or=async(e,r,a,o)=>{const{data:s,error:l}=await D.from(e).select(r).eq(a,o);if(l)throw console.error(`Supabase query error for ${e} data:`,l.message),l;return s||[]},ir=e=>{const[r,a]=n.useState(null),[o,s]=n.useState(!0),[l,i]=n.useState({listings:0,shipmentsSent:0,shipmentsCarried:0,rating:0,reviews:0}),[c,d]=n.useState([]),[u,g]=n.useState([]),[f,m]=n.useState(!0),[h,x]=n.useState(!0),[y,b]=n.useState(null),C=Q(),{toast:j}=L(),w=n.useCallback(async v=>{var p,F;if(!v){s(!1),b(new Error("User is not authenticated."));return}s(!0),b(null),m(!0),x(!0);try{const{data:$,error:E}=await D.from("profiles").select("*").eq("id",v.id).single();if(E)throw E;a($);const[ke,we,je,z]=await Promise.all([G("listings","user_id",v.id),G("shipments","shipper_user_id",v.id),G("shipments","traveler_user_id",v.id),or("reviews","rating, id","reviewed_user_id",v.id)]),Ne=z.reduce((Pe,Me)=>Pe+Me.rating,0),_e=z.length>0?(Ne/z.length).toFixed(1):0;i({listings:ke,shipmentsSent:we,shipmentsCarried:je,rating:parseFloat(_e),reviews:z.length});const Se=D.from("shipments").select("*, traveler_profile:profiles!shipments_traveler_user_id_fkey(full_name, avatar_url), listing:listings(origin, destination, departure_date)").eq("shipper_user_id",v.id).order("created_at",{ascending:!1}),Ce=D.from("shipments").select("*, sender_profile:profiles!shipments_shipper_user_id_fkey(full_name, avatar_url), listing:listings(origin, destination, departure_date)").eq("traveler_user_id",v.id).order("created_at",{ascending:!1}),[{data:$e,error:J},{data:De,error:ee}]=await Promise.all([Se,Ce]);if(J)throw J;if(d($e||[]),m(!1),ee)throw ee;g(De||[]),x(!1)}catch($){console.error("Dashboard data fetch error:",$),b($);let E=$.message||"An unexpected error occurred.";(p=$.message)!=null&&p.toLowerCase().includes("failed to fetch")||(F=$.message)!=null&&F.toLowerCase().includes("network error")?E="A network error occurred while loading dashboard data. Please check your internet connection and try again.":$.code==="PGRST116"&&(E="Your profile could not be found. It might not have been created yet. Please try refreshing the page."),j({title:"Error Loading Dashboard Data",description:E,variant:"destructive",icon:t.jsx(oe,{className:"h-5 w-5 text-destructive-foreground"})})}finally{s(!1)}},[j]);n.useEffect(()=>{e!=null&&e.user?w(e.user):!e&&e!==void 0&&s(!1)},[e,w,C]);const O=n.useCallback(async v=>{if(e!=null&&e.user)try{const{error:p}=await D.from("profiles").update(v).eq("id",e.user.id);if(p)throw p;return a(F=>({...F,...v})),{success:!0}}catch(p){throw console.error("Failed to update profile:",p),p}},[e]);return{profile:r,loading:o,stats:l,error:y,handleProfileUpdate:O,sentShipments:c,carryingShipments:u,isLoadingSent:f,isLoadingCarrying:h,fetchAllData:w}},ve=({onRetry:e,onGoHome:r})=>t.jsxs("div",{className:"container mx-auto py-8 px-4 md:px-6 text-center flex flex-col items-center justify-center min-h-[calc(100vh-200px)]",children:[t.jsx(oe,{className:"w-16 h-16 text-destructive mb-4"}),t.jsx("h2",{className:"text-2xl font-semibold text-destructive mb-2",children:"Error Loading Dashboard"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Could not load your dashboard data. This might be due to an incomplete profile or a network issue. Please try again, or if the problem persists, ensure your profile is fully set up."}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsx(_,{onClick:e,className:"bg-primary hover:bg-primary/90 text-white",children:"Retry"}),t.jsx(_,{onClick:r,variant:"outline",children:"Go to Homepage"})]})]});ve.displayName="DashboardDataErrorDisplay";const lr={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},Rr=()=>{var O,v;const{session:e,loading:r,authError:a,signOut:o}=U(),{profile:s,loading:l,stats:i,error:c,handleProfileUpdate:d,sentShipments:u,carryingShipments:g,isLoadingSent:f,isLoadingCarrying:m,fetchAllData:h}=ir(e),x=Q(),y=Le(),[b,C]=n.useState(((O=y.state)==null?void 0:O.defaultTab)||"profile");if(n.useEffect(()=>{var p;(p=y.state)!=null&&p.defaultTab&&C(y.state.defaultTab)},[y.state]),r||l&&!s)return t.jsx(P,{fullScreen:!0});if(a)return t.jsx(ct,{onRetry:()=>window.location.reload(),message:a.message||"Could not verify your session. Please check your internet connection and try again."});if(!e)return t.jsx(nr,{onSignIn:()=>x("/signin",{state:{from:"/dashboard"}})});if(c&&!s)return t.jsx(ve,{onRetry:()=>h(e.user),onGoHome:()=>x("/")});if(!s)return t.jsx(P,{fullScreen:!0});const w=[{value:"profile",label:"Profile",icon:dt,content:t.jsx(Pt,{profile:s,session:e,onProfileUpdate:d,stats:i})},{value:"shipments",label:"My Shipments",icon:ne,content:t.jsx(lt,{sentShipments:u,carryingShipments:g,isLoadingSent:f,isLoadingCarrying:m})},{value:"messages",label:"Messages",icon:Ie,content:t.jsx("p",{className:"text-center text-muted-foreground",children:"ðŸš§ This feature isn't implemented yetâ€”but don't worry! You can request it in your next prompt! ðŸš€"})},{value:"reviews",label:"My Reviews",icon:ce,content:t.jsx(Et,{userId:(v=e==null?void 0:e.user)==null?void 0:v.id})},{value:"settings",label:"Settings",icon:ht,content:t.jsx(ar,{onSignOut:o})}];return t.jsxs(T.div,{initial:"initial",animate:"in",exit:"out",variants:lr,transition:{duration:.5},className:"container mx-auto py-8 px-4 md:px-6 text-foreground dark:text-slate-100",children:[t.jsx(Ct,{profile:s,onSignOut:o}),t.jsx(Dt,{}),t.jsxs(Oe,{value:b,onValueChange:C,className:"mt-8",children:[t.jsx(Fe,{className:"grid w-full grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 bg-primary/10 dark:bg-slate-800/60 p-2 rounded-lg shadow-inner",children:w.map(p=>t.jsxs(ze,{value:p.value,className:`flex items-center justify-center py-3 px-2 text-sm font-medium rounded-md transition-all
                            text-slate-600 dark:text-slate-300 
                            hover:bg-sky-100 dark:hover:bg-slate-700/80
                            data-[state=active]:bg-gradient-to-r data-[state=active]:from-sky-400 data-[state=active]:to-cyan-400 
                            dark:data-[state=active]:from-purple-500 dark:data-[state=active]:to-indigo-500
                            data-[state=active]:text-white data-[state=active]:shadow-md`,children:[t.jsx(p.icon,{className:"w-5 h-5 mr-2"}),p.label]},p.value))}),w.map(p=>t.jsx(qe,{value:p.value,className:"mt-6 bg-card dark:bg-slate-800/40 p-4 md:p-6 rounded-lg shadow-md",children:(f||m)&&b===p.value?t.jsx(P,{}):p.content},p.value))]})]})};export{Rr as default};
