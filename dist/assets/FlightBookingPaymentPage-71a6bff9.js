import{c as S,a2 as A,u as M,b as T,r as a,j as e,x as j,C as X,B as m,m as N,I as F,s as v}from"./index-90132984.js";import{C as z,b as E,c as L,d as W,a as R,e as $}from"./card-20bc08aa.js";import{L as O}from"./label-10800e5f.js";import{C as w}from"./check-circle-309764a3.js";const q=S("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),C=S("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Z=()=>{const{bookingId:n}=A(),o=M(),{toast:r}=T(),[i,_]=a.useState(null),[B,x]=a.useState(!0),[d,J]=a.useState("bank_deposit_ssp"),[p,I]=a.useState(""),[h,u]=a.useState(!1),[g,b]=a.useState(""),P={accountName:"TripOn24/7 Flights LTD",accountNumber:"001234567890 (SSP Account)",bankName:"Nile Commercial Bank (NCB)",branch:"Juba Main Branch",swiftCode:"NCBJSSJBXXX"},f="+211 9XX XXX XXX (TripOn24/7 Flights)";a.useEffect(()=>{n&&(async()=>{x(!0);try{const{data:t,error:c}=await v.from("flight_bookings").select("*").eq("id",n).single();if(c)throw c;if(!t)throw new Error("Booking not found");_(t),(t.payment_status==="payment_confirmed"||t.booking_status==="ticket_issued")&&(r({title:"Payment Already Made",description:"This booking's payment is already confirmed or ticket issued."}),o(`/tracking/flight/${n}`))}catch(t){console.error("Error fetching booking details:",t),r({variant:"destructive",title:"Error",description:"Could not load booking details. "+t.message}),o("/bookings")}finally{x(!1)}})()},[n,r,o]);const y=(s,t)=>{navigator.clipboard.writeText(s).then(()=>{b(t),r({title:"Copied!",description:`${t} copied to clipboard.`}),setTimeout(()=>b(""),2e3)}).catch(c=>{r({variant:"destructive",title:"Copy Failed",description:"Could not copy text."})})},D=async s=>{if(s.preventDefault(),d==="bank_deposit_ssp"&&!p){r({variant:"destructive",title:"Missing Information",description:"Please enter your bank payment reference ID."});return}u(!0);try{const t={payment_method:d,payment_reference_id:p,payment_status:"pending_whatsapp_confirmation",updated_at:new Date().toISOString()},{data:c,error:k}=await v.from("flight_bookings").update(t).eq("id",n).select().single();if(k)throw k;r({title:"Payment Information Submitted",description:"Please send your payment receipt screenshot to our WhatsApp number."}),o(`/tracking/flight/${n}`)}catch(t){console.error("Error submitting payment info:",t),r({variant:"destructive",title:"Submission Failed",description:"Could not submit payment information. "+t.message})}finally{u(!1)}};if(B)return e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-200px)]",children:e.jsx(j,{className:"h-12 w-12 animate-spin text-primary"})});if(!i)return e.jsxs("div",{className:"container mx-auto py-12 px-4 text-center",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Booking Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"We couldn't find the booking you're looking for."}),e.jsx(m,{onClick:()=>o("/bookings"),className:"mt-6",children:"Go to My Bookings"})]});const l=i.flight_details;return e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto py-8 px-4 md:px-6",children:e.jsxs(z,{className:"max-w-2xl mx-auto shadow-2xl glassmorphism-form dark:bg-slate-800/70 border-slate-200 dark:border-slate-700/50",children:[e.jsxs(E,{className:"bg-gradient-to-r from-primary to-purple-600 text-white p-6 rounded-t-lg",children:[e.jsx(L,{className:"text-2xl md:text-3xl",children:"Complete Your Flight Payment"}),e.jsxs(W,{className:"text-purple-200",children:["Booking ID: ",i.id]})]}),e.jsxs(R,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-foreground dark:text-white",children:"Flight Summary"}),e.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 dark:bg-slate-700/50 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Route:"})," ",l.from," to ",l.to]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Airline:"})," ",l.airline]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Departure:"})," ",new Date(l.departureDate).toLocaleDateString()," at ",l.departureTime]}),e.jsxs("p",{className:"text-xl font-bold text-primary dark:text-secondary mt-2",children:["Total Amount: ",i.total_price_ssp," SSP"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-foreground dark:text-white",children:"Select Payment Method"}),e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${d==="bank_deposit_ssp"?"border-primary ring-2 ring-primary bg-primary/5 dark:bg-secondary/10":"border-slate-300 dark:border-slate-600 hover:border-slate-400 dark:hover:border-slate-500"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:`mr-3 h-6 w-6 ${d==="bank_deposit_ssp"?"text-primary dark:text-secondary":"text-muted-foreground"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground dark:text-white",children:"Bank Deposit (SSP)"}),e.jsx("p",{className:"text-xs text-muted-foreground dark:text-slate-400",children:"Pay in South Sudanese Pounds via direct bank transfer."})]})]})})]}),d==="bank_deposit_ssp"&&e.jsxs(N.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3},className:"space-y-4 overflow-hidden",children:[e.jsx("h4",{className:"text-md font-semibold text-foreground dark:text-white",children:"Bank Deposit Instructions:"}),e.jsxs("div",{className:"p-4 border rounded-lg bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 text-sm space-y-2",children:[e.jsxs("p",{children:["Please deposit ",e.jsxs("strong",{children:[i.total_price_ssp," SSP"]})," to the following account:"]}),Object.entries(P).map(([s,t])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"capitalize font-medium text-blue-800 dark:text-blue-300",children:[s.replace(/([A-Z])/g," $1").trim(),":"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-200 mr-2",children:t}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>y(t,s),className:"h-6 w-6 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-700",children:g===s?e.jsx(w,{size:14,className:"text-green-500"}):e.jsx(C,{size:14})})]})]},s))]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-700 text-sm space-y-2",children:[e.jsx("p",{children:"After payment, send a clear screenshot of your deposit receipt to our WhatsApp number:"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-green-800 dark:text-green-300",children:"WhatsApp:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-700 dark:text-green-200 mr-2",children:f}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>y(f,"WhatsApp Number"),className:"h-6 w-6 text-green-600 dark:text-green-400 hover:bg-green-200 dark:hover:bg-green-700",children:g==="WhatsApp Number"?e.jsx(w,{size:14,className:"text-green-500"}):e.jsx(C,{size:14})})]})]}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Important:"})," Include your Booking ID ",e.jsx("strong",{className:"text-green-700 dark:text-green-200",children:i.id})," in your WhatsApp message."]})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"paymentReference",className:"text-foreground dark:text-white",children:"Bank Payment Reference ID"}),e.jsx(F,{id:"paymentReference",type:"text",value:p,onChange:s=>I(s.target.value),placeholder:"Enter your bank's transaction/reference ID",required:!0,className:"mt-1 dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),e.jsxs(m,{type:"submit",className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:opacity-90 text-white",disabled:h,children:[h?e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Confirm Payment Information Sent"]})]})]})]}),e.jsx($,{className:"p-6 border-t dark:border-slate-700/50",children:e.jsx("p",{className:"text-xs text-muted-foreground dark:text-slate-400",children:'Your booking will be confirmed once payment is verified. Ticket issuance follows payment confirmation. You can track your booking status on the "My Bookings" page.'})})]})})};export{Z as default};
