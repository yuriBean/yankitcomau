import{c as P,y as D,r as d,b as z,s as b,u as T,a as F,j as e,z as v,m as E,B as j}from"./index-90132984.js";import{C as A,b as U,c as S,d as M,a as Y,e as q}from"./card-20bc08aa.js";import{T as H,a as $,b as k,c as L}from"./tabs-1cd19a03.js";import{A as B,a as I,b as V,c as R,d as O,e as G,f as J,g as K}from"./alert-dialog-e7e47e0b.js";import{P as Q}from"./plane-takeoff-693a2ada.js";import{P as W}from"./package-63d15fb6.js";import{L as X,T as Z}from"./trash-2-c21e1822.js";import{P as ee}from"./pen-square-e60d8ce1.js";import{P as se}from"./plus-circle-68c8968c.js";import"./index-8d46d079.js";const N=P("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),te=()=>{var p;const{session:g}=D(),[i,o]=d.useState([]),[x,m]=d.useState(!0),{toast:n}=z(),s=(p=g==null?void 0:g.user)==null?void 0:p.id,l=d.useCallback(async t=>{if(!t){o([]),m(!1);return}m(!0);try{const{data:a,error:f}=await b.from("listings").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(f)throw new Error(f.message||"Failed to fetch user listings");o(a||[])}catch(a){console.error("Error fetching user listings:",a),n({title:"Error Fetching Listings",description:a.message,variant:"destructive"}),o([])}finally{m(!1)}},[n]),h=d.useMemo(()=>i.filter(t=>t.listing_type==="yanking"),[i]),u=d.useMemo(()=>i.filter(t=>t.listing_type==="shipping"),[i]),c=async t=>{try{const{error:a}=await b.from("listings").delete().eq("id",t);if(a)throw a;return n({title:"Success!",description:"Your listing has been deleted."}),l(s),!0}catch(a){return console.error("Error deleting listing:",a),n({title:"Error",description:`Failed to delete listing: ${a.message}`,variant:"destructive"}),!1}};return d.useEffect(()=>{l(s||null)},[s,l]),{listings:i,yankingListings:h,shippingListings:u,isLoading:x,currentUserId:s,deleteListing:c,refetchListings:()=>{s&&l(s)}}},ae={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},ie=()=>e.jsxs(E.div,{className:"text-center mb-12",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx(X,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-primary via-purple-500 to-secondary mb-3",children:"My Listings"}),e.jsx("p",{className:"text-lg text-muted-foreground dark:text-slate-300 max-w-xl mx-auto",children:"Manage your yanking and sending listings. Edit, view, or remove them as needed."})]}),w=({listing:g,onEdit:i,onDelete:o})=>{const{id:x,origin:m,destination:n,departure_date:s,available_space_kg:l,number_of_bags:h,total_potential_earnings:u,status:c}=g,p=c?c.charAt(0).toUpperCase()+c.slice(1):"Unknown",t=c==="active"?"text-green-500":"text-yellow-500";return e.jsxs(A,{className:"shadow-lg hover:shadow-xl transition-shadow duration-300 glassmorphism dark:bg-slate-800/50 dark:border-slate-700/50",children:[e.jsxs(U,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(S,{className:"text-lg font-semibold text-foreground dark:text-slate-100",children:[m," â†’ ",n]}),e.jsx("span",{className:`text-sm font-semibold ${t}`,children:p})]}),e.jsxs(M,{className:"text-sm text-muted-foreground dark:text-slate-400 pt-1",children:["Departure: ",new Date(s).toLocaleDateString()]})]}),e.jsxs(Y,{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"font-medium",children:[e.jsx("span",{className:"text-muted-foreground dark:text-slate-400 block text-xs",children:"Space"})," ",l," kg"]}),e.jsxs("div",{className:"font-medium",children:[e.jsx("span",{className:"text-muted-foreground dark:text-slate-400 block text-xs",children:"Bags"})," ",h]}),e.jsxs("div",{className:"font-medium",children:[e.jsx("span",{className:"text-muted-foreground dark:text-slate-400 block text-xs",children:"Earnings"})," $",u]})]}),e.jsxs(q,{className:"flex justify-end gap-2 pt-4",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>i(x),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"})," Edit"]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>o(x),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"})," Delete"]})]})]})},C=({title:g,description:i,buttonText:o,buttonLink:x,icon:m})=>{const n=T();return e.jsxs(A,{className:"text-center p-8 shadow-lg glassmorphism border-none dark:bg-slate-800/40 mt-8",children:[e.jsx(m,{size:48,className:"mx-auto mb-4 text-primary"}),e.jsx(S,{className:"text-xl font-semibold text-foreground dark:text-white",children:g}),e.jsx(M,{className:"text-muted-foreground dark:text-slate-300 mt-2 mb-4",children:i}),e.jsxs(j,{onClick:()=>n(x),children:[e.jsx(se,{className:"w-4 h-4 mr-2"})," ",o]})]})},he=()=>{var y;const{isLoading:g}=D(),{yankingListings:i,shippingListings:o,isLoading:x,deleteListing:m}=te(),n=T(),s=F(),[l,h]=d.useState(!1),[u,c]=d.useState(null),[p,t]=d.useState(((y=s.state)==null?void 0:y.activeTab)||"yanking");d.useEffect(()=>{var r;(r=s.state)!=null&&r.activeTab&&(t(s.state.activeTab),n(s.pathname,{replace:!0,state:{}}))},[s.state,n,s.pathname]);const a=r=>{n(`/edit-listing/${r}`)},f=r=>{c(r)},_=async()=>{u&&(h(!0),await m(u),h(!1),c(null))};return g||x?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(v,{})}):e.jsxs(E.div,{initial:"initial",animate:"in",exit:"out",variants:ae,transition:{duration:.5},className:"container mx-auto py-12 px-4 md:px-6 min-h-[calc(100vh-180px)]",children:[e.jsx(ie,{}),e.jsxs(H,{value:p,onValueChange:t,className:"w-full",children:[e.jsxs($,{className:"grid w-full grid-cols-2",children:[e.jsxs(k,{value:"yanking",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Yankings"]}),e.jsxs(k,{value:"shipping",children:[e.jsx(W,{className:"w-4 h-4 mr-2"})," Shippings"]})]}),e.jsx(L,{value:"yanking",children:i.length===0?e.jsx(C,{title:"You have no yanking listings.",description:"List your available baggage space to start earning.",buttonText:"Create Yanking Listing",buttonLink:"/list-your-bag",icon:N}):e.jsx("div",{className:"space-y-4 mt-8",children:i.map(r=>e.jsx(w,{listing:r,onEdit:a,onDelete:f},r.id))})}),e.jsx(L,{value:"shipping",children:o.length===0?e.jsx(C,{title:"You have no shipping listings.",description:"Request to send a bag with a traveler.",buttonText:"Create Shipping Listing",buttonLink:"/send-a-bag",icon:N}):e.jsx("div",{className:"space-y-4 mt-8",children:o.map(r=>e.jsx(w,{listing:r,onEdit:a,onDelete:f},r.id))})})]}),e.jsx(B,{open:!!u,onOpenChange:()=>c(null),children:e.jsxs(I,{children:[e.jsxs(V,{children:[e.jsx(R,{children:"Are you sure?"}),e.jsx(O,{children:"This action cannot be undone. This will permanently delete your listing."})]}),e.jsxs(G,{children:[e.jsx(J,{disabled:l,children:"Cancel"}),e.jsx(K,{onClick:_,disabled:l,className:"bg-destructive hover:bg-destructive/90",children:l?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm"})," Deleting..."]}):"Delete"})]})]})})]})};export{he as default};
