import{c as E,a2 as F,u as B,b as A,r as i,j as e,z as _,B as d,m as V,e as q,I as z}from"./index-90132984.js";import{s as y}from"./customSupabaseClient-6a2b5399.js";import{C as M,b as T,c as H,d as O,a as $}from"./card-20bc08aa.js";import{L as o}from"./label-10800e5f.js";import{A as S,P as U,a as R,b as Y,C as G}from"./calendar-60683eee.js";import{S as J,a as K,b as Q,c as W,d as C}from"./select-e1bdb456.js";import{A as X}from"./alert-circle-e286b5b5.js";import{A as N}from"./arrow-left-51d5f9cd.js";import{P as Z}from"./pen-square-e60d8ce1.js";import{C as ee}from"./calendar-a9d8c619.js";import{f as te}from"./index-928e16c7.js";import"./extends-4c19d496.js";import"./dialog-0bf9ccb8.js";import"./index-80c31fef.js";import"./scroll-area-3fa250e8.js";import"./index-53deacd1.js";import"./chevron-right-4de65084.js";import"./index-8d46d079.js";import"./index-b712ad6b.js";import"./chevron-down-fad37da9.js";const ae=E("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),se={initial:{opacity:0,x:-50},in:{opacity:1,x:0},out:{opacity:0,x:50}},Ne=()=>{const{listingId:c}=F(),m=B(),{toast:n}=A(),[ie,w]=i.useState(null),[k,x]=i.useState(!0),[h,u]=i.useState(!1),[f,j]=i.useState(null),[s,g]=i.useState({origin:"",destination:"",departure_date:null,number_of_bags:1,available_space_kg:20}),v=i.useCallback(async()=>{x(!0),j(null);try{const{data:t,error:a}=await y.from("listings").select("*").eq("id",c).single();if(a)throw a;if(!t)throw new Error("Listing not found.");w(t),g({origin:t.origin,destination:t.destination,departure_date:new Date(t.departure_date),number_of_bags:t.number_of_bags,available_space_kg:t.available_space_kg})}catch(t){console.error("Error fetching listing:",t),j("Could not load the listing data. It might have been deleted."),n({title:"Error",description:`Failed to fetch listing: ${t.message}`,variant:"destructive"})}finally{x(!1)}},[c,n]);i.useEffect(()=>{v()},[v]);const p=(t,a)=>{g(r=>({...r,[t]:a}))},L=t=>{const a=parseInt(t,10);g(r=>({...r,number_of_bags:a,available_space_kg:a*20}))},P=async t=>{t.preventDefault(),u(!0);const{origin:a,destination:r,departure_date:b,number_of_bags:I,available_space_kg:D}=s;if(!a||!r||!b){n({title:"Missing Information",description:"Please fill all fields.",variant:"destructive"}),u(!1);return}try{const{error:l}=await y.from("listings").update({origin:a,destination:r,departure_date:b.toISOString(),number_of_bags:I,available_space_kg:D}).eq("id",c);if(l)throw l;n({title:"Success! âœ¨",description:"Your listing has been updated successfully."}),m("/my-listings")}catch(l){console.error("Error updating listing:",l),n({title:"Update Failed",description:`Could not update listing: ${l.message}`,variant:"destructive"})}finally{u(!1)}};return k?e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-180px)]",children:e.jsx(_,{size:"lg"})}):f?e.jsxs("div",{className:"container mx-auto py-12 px-4 md:px-6 flex flex-col items-center justify-center text-center min-h-[calc(100vh-180px)]",children:[e.jsx(X,{className:"w-16 h-16 text-destructive mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Oops! Something went wrong."}),e.jsx("p",{className:"text-muted-foreground mb-6",children:f}),e.jsxs(d,{onClick:()=>m("/my-listings"),children:[e.jsx(N,{className:"mr-2 h-4 w-4"})," Back to My Listings"]})]}):e.jsx(V.div,{variants:se,initial:"initial",animate:"in",exit:"out",transition:{duration:.4},className:"container mx-auto py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs(d,{variant:"ghost",onClick:()=>m("/my-listings"),className:"mb-4",children:[e.jsx(N,{className:"mr-2 h-4 w-4"})," Back to My Listings"]}),e.jsxs(M,{className:"glassmorphism dark:bg-slate-800/50",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Z,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx(H,{className:"text-3xl font-bold text-foreground dark:text-white",children:"Edit Listing"}),e.jsx(O,{className:"text-muted-foreground dark:text-slate-400",children:"Update the details of your baggage space offer."})]})]})}),e.jsx($,{children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"origin",children:"Origin"}),e.jsx(S,{type:"origin",value:s.origin,onChange:t=>p("origin",t)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"destination",children:"Destination"}),e.jsx(S,{type:"destination",value:s.destination,onChange:t=>p("destination",t)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"departure_date",children:"Departure Date"}),e.jsxs(U,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:q("w-full justify-start text-left font-normal",!s.departure_date&&"text-muted-foreground"),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),s.departure_date?te(s.departure_date,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Y,{className:"w-auto p-0",children:e.jsx(G,{mode:"single",selected:s.departure_date,onSelect:t=>p("departure_date",t),disabled:t=>t<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"number_of_bags",children:"Number of Bags"}),e.jsxs(J,{onValueChange:L,defaultValue:String(s.number_of_bags),children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Select bags"})}),e.jsxs(W,{children:[e.jsx(C,{value:"1",children:"1 Bag (20kg)"}),e.jsx(C,{value:"2",children:"2 Bags (40kg)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Available Space (kg)"}),e.jsx(z,{value:s.available_space_kg,disabled:!0})]}),e.jsx(d,{type:"submit",className:"w-full",disabled:h,children:h?e.jsx(_,{}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Save Changes"]})})]})})]})]})})};export{Ne as default};
