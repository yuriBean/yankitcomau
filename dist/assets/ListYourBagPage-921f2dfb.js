import{c as X,y as F,u as z,b as K,r as j,R as I,j as e,B as L,e as J,C as Q,m as E,F as A,x as Z,D as ee}from"./index-90132984.js";import{A as S,a as P,b as D}from"./alert-aae95b33.js";import{C as Y,b as q,c as G,a as V,d as te,e as ae}from"./card-20bc08aa.js";import{u as se,C as _}from"./index.esm-d4f1bdfa.js";import{s as B}from"./customSupabaseClient-6a2b5399.js";import{a as M,M as re}from"./constants-c4706f3e.js";import{L as w}from"./label-10800e5f.js";import{A as T,P as ne,a as ie,b as le,C as oe}from"./calendar-60683eee.js";import{S as de,a as ce,b as me,c as ue,d as xe}from"./select-e1bdb456.js";import{T as ge}from"./trending-up-869bffca.js";import{f as pe}from"./index-928e16c7.js";import{P as R}from"./package-plus-ec74be9a.js";import"./extends-4c19d496.js";import"./dialog-0bf9ccb8.js";import"./index-80c31fef.js";import"./scroll-area-3fa250e8.js";import"./index-53deacd1.js";import"./chevron-right-4de65084.js";import"./index-8d46d079.js";import"./index-b712ad6b.js";import"./chevron-down-fad37da9.js";const he=X("CalendarPlus",[["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["line",{x1:"19",x2:"19",y1:"16",y2:"22",key:"1ttwzi"}],["line",{x1:"16",x2:"22",y1:"19",y2:"19",key:"1g9955"}]]),C=t=>typeof t=="string"?t:(t==null?void 0:t.value)??null,be=5,fe=()=>{const{session:t}=F(),i=z(),{toast:n}=K(),[m,r]=j.useState(!1),[c,a]=j.useState(null),[l,d]=j.useState(null),[s,g]=j.useState(!1),o=se({defaultValues:{origin:null,destination:null,departure_date:null,number_of_bags:"1"}}),{watch:N}=o,b=N("origin"),f=N("destination"),k=j.useCallback(async()=>{const u=C(b),p=C(f);if(u&&p){if(g(!0),r(!0),a(null),d(null),u===p){o.setError("destination",{type:"manual",message:"Origin and destination airports cannot be the same."}),r(!1);return}try{const{data:h,error:v}=await B.from("flight_routes_data").select("distance_km, yanker_earnings").eq("origin_iata",u).eq("destination_iata",p).maybeSingle();v||!h?(a(null),d(null)):(a(Number(h.distance_km??0)||null),d(Number(h.yanker_earnings??0)||null),o.clearErrors("destination"))}catch{a(null),d(null)}finally{r(!1)}}else g(!1),a(null),d(null)},[b,f,o]);j.useEffect(()=>{const u=setTimeout(()=>{k()},500);return()=>clearTimeout(u)},[b,f,k]);const x=async u=>{if(!(t!=null&&t.user)){n({title:"Authentication Error",description:"You must be logged in to list your baggage.",variant:"destructive"});return}const p=C(u.origin),h=C(u.destination);if(p&&h&&p===h){n({title:"Validation Error",description:"Origin and destination cannot be the same.",variant:"destructive"});return}const v=parseInt(u.number_of_bags,10)||1,H=l&&Number(l)>0?Number(l):be,$=Math.min(M,20),W=H*v;r(!0);try{const{error:y}=await B.from("listings").insert({user_id:t.user.id,origin:p,destination:h,departure_date:u.departure_date,available_space_kg:$,number_of_bags:v,total_potential_earnings:W,status:"active",listing_type:"yanking"});if(y)throw y;n({title:"Success!",description:"Your baggage space has been listed."}),i("/my-listings",{state:{activeTab:"yanking"}})}catch(y){console.error("Error creating listing:",y),n({title:"Error Creating Listing",description:y.message||"An unexpected error occurred.",variant:"destructive"})}finally{r(!1)}};return{form:o,isLoading:m,estimatedDistance:c,estimatedEarnings:l,onSubmit:o.handleSubmit(x),estimateAttempted:s}},O=I.memo(({origin:t,destination:i,numberOfBags:n,estimatedDistance:m,estimatedEarnings:r})=>{const c=t&&i&&(m===null||r===null),a=t&&i&&m!==null&&r!==null,l=n&&parseInt(n,10)>0;return e.jsxs(Y,{className:"bg-gradient-to-r from-sky-50 to-blue-50 dark:from-slate-700 dark:to-slate-800 p-4 rounded-lg shadow min-h-[120px] flex flex-col justify-center",children:[e.jsx(q,{className:"p-0 pb-2",children:e.jsxs(G,{className:"text-md font-semibold text-primary dark:text-sky-300 flex items-center",children:[e.jsx(ge,{className:"w-5 h-5 mr-2"}),"Estimated Earnings & Distance"]})}),e.jsxs(V,{className:"p-0 text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground dark:text-slate-400",children:"Flight Distance:"}),e.jsx("span",{className:"font-medium text-foreground dark:text-white",children:a?`${m} km`:c?"Calculating...":"Select airports"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground dark:text-slate-400",children:"Potential Earnings (per bag):"}),e.jsx("span",{className:"font-bold text-green-600 dark:text-green-400 text-lg",children:a?`A${r.toFixed(2)}`:c?"Calculating...":"Select airports"})]}),a&&l&&e.jsxs("div",{className:"flex justify-between items-center pt-1 border-t border-slate-300 dark:border-slate-600 mt-1",children:[e.jsx("span",{className:"text-muted-foreground dark:text-slate-400 font-semibold",children:"Total Potential Earnings:"}),e.jsxs("span",{className:"font-extrabold text-green-600 dark:text-green-300 text-xl",children:["A",(r*parseInt(n,10)).toFixed(2)]})]})]})]})});O.displayName="EstimatedEarningsCard";const U=I.memo(({form:t,isLoading:i,estimatedDistance:n,estimatedEarnings:m,numberOfBags:r})=>{var l,d;const{control:c,formState:{errors:a}}=t;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"origin",className:"font-semibold dark:text-slate-200",children:"Origin Airport"}),e.jsx(_,{name:"origin",control:c,rules:{required:"Origin airport is required."},render:({field:s})=>e.jsx(T,{value:s.value,onChange:s.onChange,placeholder:"Select Origin Airport",disabled:i,type:"origin"})}),a.origin&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:a.origin.message})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"destination",className:"font-semibold dark:text-slate-200",children:"Destination Airport"}),e.jsx(_,{name:"destination",control:c,rules:{required:"Destination airport is required."},render:({field:s})=>e.jsx(T,{value:s.value,onChange:s.onChange,placeholder:"Select Destination Airport",disabled:i,type:"destination"})}),a.destination&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:a.destination.message})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"departure_date",className:"font-semibold dark:text-slate-200",children:"Departure Date"}),e.jsx(_,{name:"departure_date",control:c,rules:{required:"Departure date is required."},render:({field:s})=>e.jsxs(ne,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:J("w-full justify-start text-left font-normal dark:bg-slate-700 dark:text-white",!s.value&&"text-muted-foreground"),disabled:i,children:[e.jsx(he,{className:"mr-2 h-4 w-4 text-primary"}),s.value?pe(s.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(le,{className:"w-auto p-0 bg-background dark:bg-slate-800 border-border",children:e.jsx(oe,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:g=>g<new Date(new Date().setDate(new Date().getDate()-1))||i,initialFocus:!0})})]})}),a.departure_date&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:a.departure_date.message})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"number_of_bags",className:"font-semibold dark:text-slate-200",children:"Number of Bags You Can Carry"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{name:"number_of_bags",control:c,rules:{required:"Number of bags is required."},render:({field:s})=>e.jsxs(de,{onValueChange:s.onChange,defaultValue:s.value,disabled:i,children:[e.jsx(ce,{className:"w-full pl-10 dark:bg-slate-700 dark:text-white dark:border-slate-600",children:e.jsx(me,{placeholder:"Select number of bags"})}),e.jsx(ue,{className:"dark:bg-slate-800 dark:text-white",children:[...Array(re)].map((g,o)=>e.jsxs(xe,{value:`${o+1}`,children:[o+1," Bag",o>0?"s":""]},o+1))})]})})]}),r&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 dark:text-slate-400",children:[e.jsx(Q,{className:"inline-block h-3 w-3 mr-1"}),"Maximum weight is ",M,"kg/bag."]}),a.number_of_bags&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:a.number_of_bags.message})]}),e.jsx(O,{origin:(l=t.getValues("origin"))==null?void 0:l.value,destination:(d=t.getValues("destination"))==null?void 0:d.value,numberOfBags:r,estimatedDistance:n,estimatedEarnings:m})]})});U.displayName="ListBaggageFormFields";const je=()=>e.jsxs(E.div,{className:"text-center mb-12",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx(R,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-blue-500 to-sky-400 mb-4 leading-tight md:leading-snug",children:"List Your Bag"}),e.jsx("p",{className:"text-lg text-muted-foreground dark:text-slate-300 max-w-2xl mx-auto",children:"Create a listing for the bag you want to send. Travellers (Yankers) will be able to see your request and make offers to carry it for you."})]}),Me=()=>{const{loading:t}=F(),{form:i,isLoading:n,estimatedDistance:m,estimatedEarnings:r,onSubmit:c,estimateAttempted:a}=fe(),{watch:l,formState:{errors:d}}=i,s=x=>typeof x=="string"?x:(x==null?void 0:x.value)??null,g=l("origin"),o=l("destination"),N=l("number_of_bags"),b=(s(g)||"").toUpperCase(),f=(s(o)||"").toUpperCase(),k=a&&!!b&&!!f&&b!==f&&m===null&&r===null;return e.jsxs("div",{className:"container mx-auto py-12 px-4 md:px-6 min-h-[calc(100vh-180px)]",children:[e.jsx(je,{}),e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:.2},children:e.jsxs(Y,{className:"max-w-3xl mx-auto shadow-xl glassmorphism border-none dark:bg-slate-800/50",children:[e.jsxs(q,{children:[e.jsx(G,{className:"text-xl text-foreground dark:text-white",children:"Enter Your Trip and Bag Details"}),e.jsxs(te,{className:"dark:text-slate-300",children:["Provide accurate information to connect with those who want to send bags. You'll be charged a small service fee by ",e.jsx("span",{className:"font-vernaccia-bold",children:"Yankit"})," from your earnings."]})]}),e.jsxs("form",{onSubmit:c,children:[e.jsxs(V,{children:[e.jsx(U,{form:i,isLoading:n||t,estimatedDistance:m,estimatedEarnings:r,numberOfBags:N}),e.jsxs("div",{className:"min-h-[60px] mt-4",children:[Object.keys(d).length>0&&e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},children:e.jsxs(S,{variant:"destructive",className:"mt-4",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(P,{children:"Error"}),e.jsx(D,{children:Object.values(d).map(x=>x.message).join(" ")})]})}),k&&!d.destination&&e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},children:e.jsxs(S,{variant:"default",className:"mt-4 bg-amber-50 border-amber-200 dark:bg-amber-900/30 dark:border-amber-800",children:[e.jsx(A,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"}),e.jsx(P,{className:"text-amber-800 dark:text-amber-300",children:"Earnings Calculation Unavailable"}),e.jsx(D,{className:"text-amber-700 dark:text-amber-400",children:"We can't estimate earnings for this route yet. You can still list your bag, and earnings will be set to $0."})]})})]})]}),e.jsx(ae,{className:"flex flex-col items-stretch gap-4",children:e.jsxs(L,{type:"submit",className:"w-full bg-gradient-to-r from-primary to-secondary hover:opacity-90 text-lg py-3",disabled:n||t,children:[n||t?e.jsx(Z,{className:"h-5 w-5 animate-spin mr-2"}):e.jsx(ee,{className:"mr-2 h-5 w-5"}),n||t?"Processing...":"Earn Money on Your Baggage Allocation"]})})]})]})})]})};export{Me as default};
