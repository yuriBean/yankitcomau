import{a as h,u as f,b as g,r as s,j as e,z as y,m as j,g as b,B as w,x as N,s as v}from"./index-90132984.js";import{C as k,b as C,c as P,d as S,a as E,e as A}from"./card-20bc08aa.js";import{A as L,a as T,b as U}from"./alert-aae95b33.js";import{P as _}from"./package-63d15fb6.js";import{A as F}from"./arrow-right-cf1dab7a.js";import{C as I}from"./credit-card-e15c187e.js";const M=()=>{var d;const x=h(),i=f(),{toast:a}=g(),[t,R]=s.useState(((d=x.state)==null?void 0:d.shipment)||null),[n,o]=s.useState(!1),[l,c]=s.useState(null),[Y,p]=s.useState("");s.useEffect(()=>{t||(a({variant:"destructive",title:"Error",description:"No shipment details found. Please create a shipment request first."}),i("/send-a-bag"))},[t,i,a]);const u=async()=>{o(!0),c(null);try{const{data:r,error:m}=await v.functions.invoke("create-revolut-payment-link",{body:{shipmentId:t.id,amount:Math.round(t.agreed_price*100),currency:t.currency}});if(m)throw new Error(m.message);if(r.error)throw new Error(r.error);if(r.paymentUrl)p(r.paymentUrl),window.location.href=r.paymentUrl;else throw new Error("Could not retrieve payment URL.")}catch(r){console.error("Payment initiation failed:",r),c(r.message||"An unknown error occurred while initiating payment."),a({variant:"destructive",title:"Payment Error",description:r.message||"Failed to initiate payment. Please try again."})}finally{o(!1)}};return t?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-sky-50 to-purple-100 dark:from-slate-900 dark:to-purple-900 py-12 px-4 sm:px-6 lg:px-8 flex items-center justify-center",children:e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(k,{className:"w-full max-w-lg shadow-2xl glassmorphism-subtle border-primary/20 dark:border-secondary/20",children:[e.jsxs(C,{className:"text-center",children:[e.jsx(b,{className:"mx-auto h-12 w-12 text-green-500"}),e.jsx(P,{className:"text-3xl font-bold mt-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Secure Your Shipment"}),e.jsx(S,{className:"text-muted-foreground pt-2",children:"Your payment will be held securely by Yankit and only released to the Yanker after successful delivery."})]}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-background/50 dark:bg-slate-800/50",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center mb-4",children:[e.jsx(_,{className:"w-6 h-6 mr-3 text-primary"}),"Shipment Summary"]}),e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Route:"}),e.jsxs("span",{className:"font-medium text-foreground",children:[t.origin," ",e.jsx(F,{className:"inline w-4 h-4"})," ",t.destination]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Item Description:"}),e.jsx("span",{className:"font-medium text-foreground truncate max-w-[200px]",children:t.item_description})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Total Weight:"}),e.jsxs("span",{className:"font-medium text-foreground",children:[t.agreed_weight_kg," kg"]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3 mt-3",children:[e.jsx("span",{className:"text-lg font-bold text-foreground",children:"Total Cost:"}),e.jsxs("span",{className:"text-xl font-extrabold text-primary",children:["$",t.agreed_price.toFixed(2)," ",t.currency]})]})]})]}),l&&e.jsxs(L,{variant:"destructive",children:[e.jsx(T,{children:"Payment Initiation Failed"}),e.jsx(U,{children:l})]})]}),e.jsx(A,{children:e.jsxs(w,{onClick:u,disabled:n,className:"w-full text-lg py-6 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg",children:[n?e.jsx(N,{className:"mr-2 h-5 w-5 animate-spin"}):e.jsx(I,{className:"mr-2 h-5 w-5"}),n?"Processing...":`Pay $${t.agreed_price.toFixed(2)} Now`]})})]})})}):e.jsx(y,{fullScreen:!0})};export{M as default};
