import{c as w,r as m,j as e,m as h,a2 as b,B as v,L as N,M as _,x as C,F as T}from"./index-90132984.js";import{H as S}from"./Helmet-f89af824.js";import{C as u,b as g,c as f,d as D,a as j}from"./card-20bc08aa.js";import{s as E}from"./customSupabaseClient-6a2b5399.js";import{C as A}from"./check-circle-309764a3.js";import{C as L}from"./clock-0376098b.js";import{A as k}from"./arrow-left-51d5f9cd.js";import{P}from"./package-63d15fb6.js";import{U as I}from"./user-404ce197.js";const $=w("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),B=s=>{if(!s)return[];const t=[],{status:r,created_at:d,updated_at:a,listing:i}=s;return t.push({title:"Shipment Created",description:"Agreement between sender and traveler has been finalized.",date:new Date(d),isComplete:!0}),i!=null&&i.departure_date&&t.push({title:"Awaiting Pickup",description:`Traveler is scheduled to pick up the item for departure on ${new Date(i.departure_date).toLocaleDateString()}.`,date:new Date(i.departure_date),isComplete:["in_transit","delivery_pending","completed","delivered"].includes(r)}),["in_transit","delivery_pending","completed","delivered"].includes(r)?t.push({title:"In Transit",description:"The traveler has started their journey with the item.",date:new Date(a),isComplete:!0}):t.push({title:"In Transit",description:"Waiting for the traveler to begin the journey.",date:null,isComplete:!1}),["delivery_pending","completed","delivered"].includes(r)?t.push({title:"Out for Delivery",description:"The traveler has arrived and is coordinating delivery with the recipient.",date:new Date(a),isComplete:!0}):t.push({title:"Out for Delivery",description:"Waiting for traveler to arrive at destination.",date:null,isComplete:!1}),["completed","delivered"].includes(r)?t.push({title:"Delivered",description:"The item has been successfully delivered to the recipient.",date:new Date(a),isComplete:!0}):t.push({title:"Delivered",description:"Awaiting confirmation of delivery.",date:null,isComplete:!1}),t.sort((c,n)=>c.date?n.date?c.date-n.date:-1:1)},z=s=>{const[t,r]=m.useState(null),[d,a]=m.useState([]),[i,l]=m.useState(!0),[p,o]=m.useState(null),c=m.useCallback(async()=>{if(!s){o("Shipment ID is missing."),l(!1);return}l(!0),o(null);try{const{data:n,error:x}=await E.from("shipments").select(`
                    *,
                    listing:listings(*),
                    sender_profile:profiles!shipments_shipper_user_id_fkey(full_name, avatar_url),
                    traveler_profile:profiles!shipments_traveler_user_id_fkey(full_name, avatar_url)
                `).eq("id",s).single();if(x)throw x;if(!n)throw new Error("Shipment not found.");r(n),a(B(n))}catch(n){console.error("Error fetching shipment details:",n),o(n.message||"An unexpected error occurred.")}finally{l(!1)}},[s]);return m.useEffect(()=>{c()},[c]),{shipment:t,trackingEvents:d,loading:i,error:p}},F=({event:s,isLast:t})=>{const{title:r,description:d,date:a,isComplete:i}=s,l=()=>i?e.jsx(A,{className:"h-5 w-5 text-green-500"}):a?e.jsx(L,{className:"h-5 w-5 text-yellow-500"}):e.jsx($,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"});return e.jsxs(h.li,{className:"relative flex items-start pb-8",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:[!t&&e.jsx("div",{className:`absolute left-[9px] top-5 h-full w-0.5 ${i?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`}),e.jsx("div",{className:"z-10 flex h-5 w-5 items-center justify-center rounded-full bg-white dark:bg-slate-800 mr-4",children:l()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${i?"text-gray-800 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:r}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:d}),a&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:new Date(a).toLocaleString()})]})]})},H=({events:s})=>!s||s.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No tracking information available."}):e.jsx("ol",{children:s.map((t,r)=>e.jsx(F,{event:t,isLast:r===s.length-1},r))}),M=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(C,{className:"h-12 w-12 text-primary animate-spin mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading shipment details..."})]}),y=({error:s})=>e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-center",children:[e.jsx(T,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("p",{className:"text-destructive font-semibold",children:"Could not load shipment details."}),e.jsx("p",{className:"text-muted-foreground text-sm max-w-md",children:s||"There was an error fetching the tracking information. Please try again later."}),e.jsx(v,{asChild:!0,variant:"outline",className:"mt-4",children:e.jsxs(N,{to:"/my-shipments",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Back to Shipments"]})})]}),Q=()=>{var p,o,c,n,x;const{shipmentId:s}=b(),{shipment:t,trackingEvents:r,loading:d,error:a}=z(s),i={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},l={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:100}}};return d?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(M,{})}):a?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(y,{error:a})}):t?e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsxs("title",{children:["Track Shipment - ",s.slice(0,8)]}),e.jsx("meta",{name:"description",content:`Tracking information for shipment ${s}.`})]}),e.jsxs(h.div,{className:"container mx-auto px-4 py-8",variants:i,initial:"hidden",animate:"visible",children:[e.jsx(h.div,{variants:l,className:"mb-6",children:e.jsx(v,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs(N,{to:"/my-shipments",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Back to My Shipments"]})})}),e.jsx(h.h1,{variants:l,className:"text-3xl md:text-4xl font-bold text-gray-800 dark:text-white mb-8",children:"Shipment Tracking"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx(h.div,{variants:l,className:"lg:col-span-2",children:e.jsxs(u,{className:"shadow-lg bg-white dark:bg-slate-800/80 backdrop-blur-sm",children:[e.jsxs(g,{children:[e.jsx(f,{className:"text-2xl",children:"Tracking Details"}),e.jsxs(D,{children:["Tracking ID: ",t.id]})]}),e.jsx(j,{children:e.jsx(H,{events:r})})]})}),e.jsxs(h.div,{variants:l,className:"space-y-6",children:[e.jsxs(u,{className:"shadow-md bg-white dark:bg-slate-800/80 backdrop-blur-sm",children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(P,{className:"mr-2 h-5 w-5 text-primary"}),"Shipment Info"]})}),e.jsxs(j,{className:"text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Item:"})," ",t.item_description||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Weight:"})," ",t.agreed_weight_kg," kg"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," $",t.agreed_price]})]})]}),e.jsxs(u,{className:"shadow-md bg-white dark:bg-slate-800/80 backdrop-blur-sm",children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(_,{className:"mr-2 h-5 w-5 text-primary"}),"Route"]})}),e.jsxs(j,{className:"text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"From:"})," ",((p=t.listing)==null?void 0:p.origin)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"To:"})," ",((o=t.listing)==null?void 0:o.destination)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Est. Departure:"})," ",(c=t.listing)!=null&&c.departure_date?new Date(t.listing.departure_date).toLocaleDateString():"N/A"]})]})]}),e.jsxs(u,{className:"shadow-md bg-white dark:bg-slate-800/80 backdrop-blur-sm",children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(I,{className:"mr-2 h-5 w-5 text-primary"}),"Participants"]})}),e.jsxs(j,{className:"text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Sender:"})," ",((n=t.sender_profile)==null?void 0:n.full_name)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Traveler:"})," ",((x=t.traveler_profile)==null?void 0:x.full_name)||"N/A"]})]})]})]})]})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(y,{error:"Shipment not found."})})};export{Q as default};
