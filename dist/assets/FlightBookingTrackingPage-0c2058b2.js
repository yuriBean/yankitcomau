import{r as a,R as W,j as t,e as Y,a2 as F,u as q,b as O,s as y,x as j,C as N,B as C,L as _,m as H,f as U,P as G}from"./index-90132984.js";import{C as X,b as Z,c as z,d as J,a as K,e as Q}from"./card-20bc08aa.js";import{_ as g}from"./extends-4c19d496.js";import{C as ee}from"./clock-0376098b.js";import{C as P}from"./check-circle-309764a3.js";import{A as S}from"./alert-circle-e286b5b5.js";function te(e,r=[]){let s=[];function n(l,c){const o=a.createContext(c),d=s.length;s=[...s,c];function m(u){const{scope:p,children:v,...x}=u,M=(p==null?void 0:p[e][d])||o,L=a.useMemo(()=>x,Object.values(x));return a.createElement(M.Provider,{value:L},v)}function f(u,p){const v=(p==null?void 0:p[e][d])||o,x=a.useContext(v);if(x)return x;if(c!==void 0)return c;throw new Error(`\`${u}\` must be used within \`${l}\``)}return m.displayName=l+"Provider",[m,f]}const i=()=>{const l=s.map(c=>a.createContext(c));return function(o){const d=(o==null?void 0:o[e])||l;return a.useMemo(()=>({[`__scope${e}`]:{...o,[e]:d}}),[o,d])}};return i.scopeName=e,[n,re(i,...r)]}function re(...e){const r=e[0];if(e.length===1)return r;const s=()=>{const n=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(l){const c=n.reduce((o,{useScope:d,scopeName:m})=>{const u=d(l)[`__scope${m}`];return{...o,...u}},{});return a.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return s.scopeName=r.scopeName,s}function se(e,r){typeof e=="function"?e(r):e!=null&&(e.current=r)}function ne(...e){return r=>e.forEach(s=>se(s,r))}const E=a.forwardRef((e,r)=>{const{children:s,...n}=e,i=a.Children.toArray(s),l=i.find(oe);if(l){const c=l.props.children,o=i.map(d=>d===l?a.Children.count(c)>1?a.Children.only(null):a.isValidElement(c)?c.props.children:null:d);return a.createElement(k,g({},n,{ref:r}),a.isValidElement(c)?a.cloneElement(c,void 0,o):null)}return a.createElement(k,g({},n,{ref:r}),s)});E.displayName="Slot";const k=a.forwardRef((e,r)=>{const{children:s,...n}=e;return a.isValidElement(s)?a.cloneElement(s,{...ie(n,s.props),ref:r?ne(r,s.ref):s.ref}):a.Children.count(s)>1?a.Children.only(null):null});k.displayName="SlotClone";const ae=({children:e})=>a.createElement(a.Fragment,null,e);function oe(e){return a.isValidElement(e)&&e.type===ae}function ie(e,r){const s={...r};for(const n in r){const i=e[n],l=r[n];/^on[A-Z]/.test(n)?i&&l?s[n]=(...o)=>{l(...o),i(...o)}:i&&(s[n]=i):n==="style"?s[n]={...i,...l}:n==="className"&&(s[n]=[i,l].filter(Boolean).join(" "))}return{...e,...s}}const le=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],A=le.reduce((e,r)=>{const s=a.forwardRef((n,i)=>{const{asChild:l,...c}=n,o=l?E:r;return a.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),a.createElement(o,g({},c,{ref:i}))});return s.displayName=`Primitive.${r}`,{...e,[r]:s}},{}),D="Progress",$=100,[ce,je]=te(D),[de,ue]=ce(D),B=a.forwardRef((e,r)=>{const{__scopeProgress:s,value:n,max:i,getValueLabel:l=fe,...c}=e,o=w(i)?i:$,d=V(n,o)?n:null,m=b(d)?l(d,o):void 0;return a.createElement(de,{scope:s,value:d,max:o},a.createElement(A.div,g({"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":b(d)?d:void 0,"aria-valuetext":m,role:"progressbar","data-state":I(d,o),"data-value":d??void 0,"data-max":o},c,{ref:r})))});B.propTypes={max(e,r,s){const n=e[r],i=String(n);return n&&!w(n)?new Error(xe(i,s)):null},value(e,r,s){const n=e[r],i=String(n),l=w(e.max)?e.max:$;return n!=null&&!V(n,l)?new Error(ge(i,s)):null}};const pe="ProgressIndicator",me=a.forwardRef((e,r)=>{var s;const{__scopeProgress:n,...i}=e,l=ue(pe,n);return a.createElement(A.div,g({"data-state":I(l.value,l.max),"data-value":(s=l.value)!==null&&s!==void 0?s:void 0,"data-max":l.max},i,{ref:r}))});function fe(e,r){return`${Math.round(e/r*100)}%`}function I(e,r){return e==null?"indeterminate":e===r?"complete":"loading"}function b(e){return typeof e=="number"}function w(e){return b(e)&&!isNaN(e)&&e>0}function V(e,r){return b(e)&&!isNaN(e)&&e<=r&&e>=0}function xe(e,r){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${$}\`.`}function ge(e,r){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${$} if no \`max\` prop is set)
  - \`null\` if the progress is indeterminate.

Defaulting to \`null\`.`}const R=B,he=me,T=W.forwardRef(({className:e,value:r,...s},n)=>t.jsx(R,{ref:n,className:Y("relative h-4 w-full overflow-hidden rounded-full bg-secondary dark:bg-slate-700",e),...s,children:t.jsx(he,{className:"h-full w-full flex-1 bg-primary dark:bg-secondary transition-all duration-500 ease-out",style:{transform:`translateX(-${100-(r||0)}%)`}})}));T.displayName=R.displayName;const be={initiated:{label:"Booking Initiated",description:"Your flight booking request has been received. Please complete payment.",progress:10,icon:t.jsx(N,{className:"h-6 w-6 text-blue-500"}),nextStep:"Complete payment via Bank Deposit and send receipt to WhatsApp."},pending_deposit:{label:"Awaiting Deposit",description:"Waiting for you to make the bank deposit and provide reference.",progress:20,icon:t.jsx(ee,{className:"h-6 w-6 text-orange-500"}),nextStep:"Make bank deposit and submit reference on payment page."},pending_whatsapp_confirmation:{label:"Awaiting WhatsApp Confirmation",description:"We've received your payment reference. Please send your deposit receipt screenshot to our WhatsApp for verification.",progress:40,icon:t.jsx(U,{className:"h-6 w-6 text-yellow-500"}),nextStep:"Our team will verify your WhatsApp submission shortly."},payment_confirmed:{label:"Payment Confirmed",description:"Your payment has been successfully confirmed. We are now processing your booking with the airline.",progress:70,icon:t.jsx(P,{className:"h-6 w-6 text-green-500"}),nextStep:"Airline is confirming your seat. Ticket will be issued soon."},booking_confirmed:{label:"Booking Confirmed with Airline",description:"Your booking is confirmed with the airline. Your e-ticket is being generated.",progress:85,icon:t.jsx(G,{className:"h-6 w-6 text-teal-500"}),nextStep:"E-ticket will be available shortly."},ticket_issued:{label:"Ticket Issued",description:"Your e-ticket has been issued! Check your email or download it from here (feature coming soon).",progress:100,icon:t.jsx(P,{className:"h-6 w-6 text-emerald-500"}),nextStep:"Your booking is complete. Have a safe trip!"},cancelled:{label:"Booking Cancelled",description:"This booking has been cancelled.",progress:0,icon:t.jsx(S,{className:"h-6 w-6 text-red-500"}),nextStep:"Contact support if you have questions."},failed:{label:"Payment Failed",description:"There was an issue with your payment. Please try again or contact support.",progress:10,icon:t.jsx(S,{className:"h-6 w-6 text-red-500"}),nextStep:"Retry payment or contact support."}},h=e=>be[e]||{label:"Unknown Status",description:"Please contact support.",progress:0,icon:t.jsx(N,{className:"h-6 w-6 text-gray-500"}),nextStep:"Contact support."},Ce=()=>{const{bookingId:e}=F(),r=q(),{toast:s}=O(),[n,i]=a.useState(null),[l,c]=a.useState(!0),[o,d]=a.useState(h("initiated")),m=a.useCallback(async()=>{c(!0);try{const{data:u,error:p}=await y.from("flight_bookings").select("*").eq("id",e).single();if(p)throw p;if(!u)throw new Error("Booking not found");i(u),d(h(u.booking_status))}catch(u){console.error("Error fetching booking details:",u),s({variant:"destructive",title:"Error",description:"Could not load booking details. "+u.message}),r("/bookings")}finally{c(!1)}},[e,s,r]);if(a.useEffect(()=>{e&&m()},[e,m]),a.useEffect(()=>{if(!e)return;const u=y.channel(`flight_booking_updates_${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"flight_bookings",filter:`id=eq.${e}`},p=>{i(p.new),d(h(p.new.booking_status)),s({title:"Booking Updated!",description:`Status changed to: ${h(p.new.booking_status).label}`})}).subscribe();return()=>{y.removeChannel(u)}},[e,s]),l)return t.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-200px)]",children:t.jsx(j,{className:"h-12 w-12 animate-spin text-primary"})});if(!n)return t.jsxs("div",{className:"container mx-auto py-12 px-4 text-center",children:[t.jsx(N,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),t.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Booking Not Found"}),t.jsx("p",{className:"text-muted-foreground",children:"We couldn't find the booking you're looking for."}),t.jsx(C,{asChild:!0,className:"mt-6",children:t.jsx(_,{to:"/bookings",children:"Go to My Bookings"})})]});const f=n.flight_details;return t.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"container mx-auto py-8 px-4 md:px-6",children:t.jsxs(X,{className:"max-w-3xl mx-auto shadow-2xl glassmorphism-form dark:bg-slate-800/70 border-slate-200 dark:border-slate-700/50",children:[t.jsxs(Z,{className:"bg-gradient-to-r from-primary to-purple-600 text-white p-6 rounded-t-lg",children:[t.jsx(z,{className:"text-2xl md:text-3xl",children:"Flight Booking Status"}),t.jsxs(J,{className:"text-purple-200",children:["Booking ID: ",n.id]})]}),t.jsxs(K,{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"p-4 border rounded-lg bg-slate-50 dark:bg-slate-700/50 text-sm space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Route:"})," ",f.from," to ",f.to]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Airline:"})," ",f.airline]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Departure:"})," ",new Date(f.departureDate).toLocaleDateString()," at ",f.departureTime]}),t.jsxs("p",{className:"text-lg font-bold text-primary dark:text-secondary mt-2",children:["Total Amount: ",f.price," ",f.currency]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-foreground dark:text-white",children:"Tracking Progress"}),t.jsxs("div",{className:"flex items-center space-x-3 p-4 rounded-lg bg-slate-100 dark:bg-slate-700/60",children:[o.icon,t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold text-lg text-foreground dark:text-white",children:o.label}),t.jsx("p",{className:"text-sm text-muted-foreground dark:text-slate-300",children:o.description})]})]}),t.jsx(T,{value:o.progress,className:"w-full h-3 [&>div]:bg-gradient-to-r [&>div]:from-blue-500 [&>div]:to-green-500"}),o.progress<100&&n.booking_status!=="cancelled"&&n.booking_status!=="failed"&&t.jsxs("div",{className:"p-3 mt-2 rounded-md bg-sky-50 dark:bg-sky-900/40 border border-sky-200 dark:border-sky-700",children:[t.jsx("p",{className:"text-sm font-medium text-sky-700 dark:text-sky-300",children:"Next Step:"}),t.jsx("p",{className:"text-sm text-sky-600 dark:text-sky-400",children:o.nextStep})]}),n.booking_status==="pending_whatsapp_confirmation"&&t.jsxs("div",{className:"p-3 mt-2 rounded-md bg-yellow-50 dark:bg-yellow-900/40 border border-yellow-300 dark:border-yellow-700",children:[t.jsx("p",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-300",children:"Action Required:"}),t.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Please send your payment receipt to our WhatsApp number.",t.jsx(_,{to:`/payment/flight/${e}`,className:"ml-1 font-semibold text-yellow-700 dark:text-yellow-200 hover:underline",children:"View Payment Instructions"})]})]})]}),n.payment_reference_id&&t.jsxs("p",{className:"text-xs text-muted-foreground dark:text-slate-400",children:["Your Payment Reference: ",n.payment_reference_id]})]}),t.jsxs(Q,{className:"p-6 border-t dark:border-slate-700/50 flex flex-col sm:flex-row justify-between items-center gap-3",children:[t.jsx("p",{className:"text-xs text-muted-foreground dark:text-slate-400 text-center sm:text-left",children:"We will notify you of status changes. You can also refresh this page."}),t.jsxs(C,{onClick:m,variant:"outline",disabled:l,children:[l?t.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Refresh Status"]})]})]})})};export{Ce as default};
